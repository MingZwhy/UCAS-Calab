From 2b71203dba79eba05b4f06a0517804a7de892826 Mon Sep 17 00:00:00 2001
From: MingZwhy <chenyuanteng20@mails.ucas.ac.cn>
Date: Tue, 20 Sep 2022 15:22:55 +0800
Subject: [PATCH] generate patch ex8 -> ex9

---
 cyt_code/ex9/mycpu_top_all.v   | 1043 --------------------------------
 cyt_code/for_patch/EX.v        |   50 +-
 cyt_code/for_patch/ID.v        |  161 +++--
 cyt_code/for_patch/MEM.v       |   16 +-
 cyt_code/for_patch/WB.v        |   14 +-
 cyt_code/for_patch/mycpu_top.v |  103 +++-
 6 files changed, 211 insertions(+), 1176 deletions(-)
 delete mode 100644 cyt_code/ex9/mycpu_top_all.v

diff --git a/cyt_code/ex9/mycpu_top_all.v b/cyt_code/ex9/mycpu_top_all.v
deleted file mode 100644
index 61debde..0000000
--- a/cyt_code/ex9/mycpu_top_all.v
+++ /dev/null
@@ -1,1043 +0,0 @@
-`define WIDTH_BR_BUS       34
-`define WIDTH_FS_TO_DS_BUS 64
-`define WIDTH_DS_TO_ES_BUS 150
-`define WIDTH_ES_TO_MS_BUS 71
-`define WIDTH_MS_TO_WS_BUS 70
-`define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 39
-`define WIDTH_MS_TO_DS_BUS 38
-/*
-`include "stage1_IF.v"
-`include "stage2_ID.v"
-`include "stage3_EX.v"
-`include "stage4_MEM.v"
-`include "stage5_WB.v"
-*/
-
-module mycpu_top(
-    input  wire        clk,
-    input  wire        resetn,
-    // inst sram interface
-    output wire        inst_sram_en,
-    output wire [3:0]  inst_sram_we,      
-    output wire [31:0] inst_sram_addr,
-    output wire [31:0] inst_sram_wdata,
-    input  wire [31:0] inst_sram_rdata,
-    // data sram interface
-    output wire        data_sram_en,
-    output wire [3:0]  data_sram_we,
-    output wire [31:0] data_sram_addr,
-    output wire [31:0] data_sram_wdata,
-    input  wire [31:0] data_sram_rdata,
-    // trace debug interface
-    output wire [31:0] debug_wb_pc,
-    output wire [ 3:0] debug_wb_rf_we,
-    output wire [ 4:0] debug_wb_rf_wnum,
-    output wire [31:0] debug_wb_rf_wdata
-);
-wire         reset;
-assign reset = ~resetn;
-
-wire [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus;
-wire ds_allow_in;
-wire fs_to_ds_valid;
-wire [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus;
-wire es_allow_in;
-wire ds_to_es_valid;
-wire [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus;
-wire ms_allow_in;
-wire es_to_ms_valid;
-wire [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus;
-wire ws_allow_in;
-wire ms_to_ws_valid;
-wire [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus;
-
-wire [`WIDTH_BR_BUS -1:0] br_bus;
-wire [`WIDTH_ES_TO_DS_BUS-1:0] es_to_ds_bus;
-wire [`WIDTH_MS_TO_DS_BUS-1:0] ms_to_ds_bus;
-
-/*---------------------------FETCH--------------------------*/
-/*
-module stage1_IF(
-    input clk,
-    input reset,
-    input ds_allow_in,
-    input [`WIDTH_BR_BUS-1:0] br_bus,
-    output fs_to_ds_valid,
-    output [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
-
-    output inst_sram_en,
-    output [3:0] inst_sram_wen,
-    output [31:0] inst_sram_addr,
-    output [31:0] inst_sram_wdata,
-
-    input [31:0] inst_sram_rdata
-);
-*/
-
-stage1_IF fetch(
-    .clk                (clk),
-    .reset              (reset),
-    .ds_allow_in        (ds_allow_in),
-    .br_bus             (br_bus),
-    .fs_to_ds_valid     (fs_to_ds_valid),
-    .fs_to_ds_bus       (fs_to_ds_bus),
-    .inst_sram_en       (inst_sram_en),
-    .inst_sram_wen      (inst_sram_we),
-    .inst_sram_addr     (inst_sram_addr),
-    .inst_sram_wdata    (inst_sram_wdata),
-    .inst_sram_rdata    (inst_sram_rdata)
-);
-
-/*----------------------------------------------------------*/
-
-
-/*---------------------------DECODE--------------------------*/
-/*
-module stage2_ID(
-    input clk,
-    input reset,
-
-    input es_allow_in,
-    output ds_allow_in,
-
-    input fs_to_ds_valid,
-    output ds_to_es_valid, 
-
-    input [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
-    output [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
-
-    //ws_to_ds_bus æ‰¿è½½ å¯„å­˜å™¨çš„å†™ä¿¡å·ï¼Œå†™åœ°ï¿???????ä¸å†™æ•°æ®
-    //ä»wbacké˜¶æ®µ é€æ¥ decodeé˜¶æ®µ 
-    input [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus;
-    //br_bus æ‰¿è½½ br_taken ï¿??????? br_target 
-    //ä»decodeé˜¶æ®µ é€å¾€ fetché˜¶æ®µ
-    output [`WIDTH_BR_BUS-1:0] br_bus,
-);
-*/
-
-stage2_ID decode(
-    .clk                (clk),
-    .reset              (reset),
-
-    .es_allow_in        (es_allow_in),
-    .ds_allow_in        (ds_allow_in),
-
-    .fs_to_ds_valid     (fs_to_ds_valid),
-    .ds_to_es_valid     (ds_to_es_valid),
-
-    .fs_to_ds_bus       (fs_to_ds_bus),
-    .ds_to_es_bus       (ds_to_es_bus),
-
-    .ws_to_ds_bus       (ws_to_ds_bus),
-    .br_bus             (br_bus),
-
-    .es_to_ds_bus       (es_to_ds_bus),
-    .ms_to_ds_bus       (ms_to_ds_bus)
-);
-
-/*----------------------------------------------------------*/
-
-
-/*---------------------------EXCUTE-------------------------*/
-/*
-module stage3_EX(
-    input clk,
-    input reset,
-
-    input ms_allow_in,
-    output es_allow_in,
-
-    input ds_to_es_valid,
-    output es_to_ms_valid,
-
-    input [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
-    output [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
-
-    output data_sram_en,
-    output [3:0]data_sram_wen,
-    output [31:0] data_sram_addr,
-    output [31:0] data_sram_wdata
-);
-*/
-
-stage3_EX ex(
-    .clk                (clk),
-    .reset              (reset),
-
-    .ms_allow_in        (ms_allow_in),
-    .es_allow_in        (es_allow_in),
-
-    .ds_to_es_valid     (ds_to_es_valid),
-    .es_to_ms_valid     (es_to_ms_valid),
-
-    .ds_to_es_bus       (ds_to_es_bus),
-    .es_to_ms_bus       (es_to_ms_bus),
-    .es_to_ds_bus       (es_to_ds_bus),
-
-    .data_sram_en       (data_sram_en),
-    .data_sram_wen      (data_sram_we),
-    .data_sram_addr     (data_sram_addr),
-    .data_sram_wdata    (data_sram_wdata)
-);
-
-/*----------------------------------------------------------*/
-
-/*---------------------------MEM----------------------------*/
-/*
-module stage4_MEM(
-    input clk,
-    input reset,
-
-    input ws_allow_in,
-    output ms_allow_in,
-
-    input es_to_ms_valid,
-    output ms_to_ws_valid,
-
-    input [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
-    output [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
-    
-    input [31:0] data_sram_rdata
-);
-*/
-
-stage4_MEM mem(
-    .clk                (clk),
-    .reset              (reset),
-
-    .ws_allow_in        (ws_allow_in),
-    .ms_allow_in        (ms_allow_in),
-
-    .es_to_ms_valid     (es_to_ms_valid),
-    .ms_to_ws_valid     (ms_to_ws_valid),
-
-    .es_to_ms_bus       (es_to_ms_bus),
-    .ms_to_ws_bus       (ms_to_ws_bus),
-    .ms_to_ds_bus       (ms_to_ds_bus),
-
-    .data_sram_rdata    (data_sram_rdata)
-);
-
-/*----------------------------------------------------------*/
-
-/*---------------------------WBACK--------------------------*/
-/*
-module stage5_WB(
-    input clk,
-    input reset,
-
-    //no allow in
-    output ws_allow_in,
-
-    input ms_to_ws_valid,
-    //no to valid
-
-    input [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
-    output [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus,
-
-    output [31:0] debug_wb_pc     ,
-    output [ 3:0] debug_wb_rf_we ,
-    output [ 4:0] debug_wb_rf_wnum,
-    output [31:0] debug_wb_rf_wdata
-);
-*/
-
-stage5_WB wb(
-    .clk                (clk),
-    .reset              (reset),
-
-    .ws_allow_in        (ws_allow_in),
-
-    .ms_to_ws_valid     (ms_to_ws_valid),
-
-    .ms_to_ws_bus       (ms_to_ws_bus),
-    .ws_to_ds_bus       (ws_to_ds_bus),
-
-    .debug_wb_pc        (debug_wb_pc),
-    .debug_wb_rf_we     (debug_wb_rf_we),
-    .debug_wb_rf_wnum   (debug_wb_rf_wnum),
-    .debug_wb_rf_wdata  (debug_wb_rf_wdata)
-);
-
-/*----------------------------------------------------------*/
-
-endmodule
-
-module stage1_IF(
-    input clk,
-    input reset,
-    input ds_allow_in,
-    input [`WIDTH_BR_BUS-1:0] br_bus,
-    output fs_to_ds_valid,
-    output [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
-
-    output inst_sram_en,
-    output [3:0] inst_sram_wen,
-    output [31:0] inst_sram_addr,
-    output [31:0] inst_sram_wdata,
-
-    input [31:0] inst_sram_rdata
-);
-
-/*--------------------------------valid-----------------------------*/
-
-reg fs_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿???????
-
-//å¯¹fs_validæ¥è¯´ï¼Œåªè¦å–æ¶ˆresetï¼Œç›¸å½“å»å‰ä¸€é˜¶æ®µå¯¹å®ƒå‘æ¥çš„validä¿¡å·
-wire pre_if_to_fs_valid;
-assign pre_if_to_fs_valid = !reset;
-
-//fs_validæ‹‰é«˜çš„å¦ï¿???????ä¸ªæ¡ä»¶æ˜¯ä¸‹ä¸€é˜¶æ®µçš„allow_inä¿¡å·â€”ï¿½?ï¿½ds_allow_in
-wire fs_ready_go;
-
-always @(posedge clk)
-    begin
-        if(reset)
-            fs_valid <= 1'b0;
-        else if(fs_allow_in)
-            fs_valid <= pre_if_to_fs_valid;
-        /*
-        else if(br_taken_cancel)
-            fs_valid <= 1'b0;
-        */
-    end
-
-//å°†output-fs_to_ds_validä¸reg fs_validè¿æ¥
-//è€ƒè™‘åˆ°ååºå¯èƒ½ä¸€ä¸ªclkå®Œæˆä¸äº†FETCHï¼Œå…ˆå¢è®¾fs_readyä¿¡å·å¹¶å§‹ç»ˆæ‹‰ï¿???????
-assign fs_ready_go = 1'b1;
-wire fs_allow_in;
-assign fs_allow_in = !fs_valid || fs_ready_go && ds_allow_in;
-assign fs_to_ds_valid = fs_valid && fs_ready_go;
-
-/*----------------------------------------------------------------*/
-
-/*--------------------------------pc------------------------------*/
-
-wire [31:0] br_target;  //è·³è½¬åœ°å€
-wire br_taken;          //æ˜¯å¦è·³è½¬
-wire br_taken_cancel;
-//br_takenå’Œbr_targetæ¥è‡ªbr_bus
-assign {br_taken_cancel,br_taken,br_target} = br_bus;
-
-reg [31:0] fetch_pc; 
-
-wire [31:0] seq_pc;     //é¡ºåºå–å€
-assign seq_pc = fetch_pc + 4;
-wire [31:0] next_pc;    //nextpcæ¥è‡ªseqæˆ–br,æ˜¯ï¿½?ï¿½è‡³ramçš„pcï¿???????
-assign next_pc = br_taken? br_target : seq_pc;
-   
-always @(posedge clk)
-    begin
-        if(reset)
-            fetch_pc <= 32'h1BFFFFFC;
-        else if(pre_if_to_fs_valid && ds_allow_in)
-            fetch_pc <= next_pc;
-    end
-
-/*----------------------------------------------------------------*/
-
-/*----------------------------ä¸inst_ramçš„æ¥ï¿???????---------------------*/
-
-/*
-    output inst_sram_en,                //è¯»ä½¿ï¿???????
-    output [3:0] inst_sram_wen,         //å†™ä½¿ï¿???????
-    output [31:0] inst_sram_addr,       //è¯»åœ°ï¿???????
-    output [31:0] inst_sram_wdata,      //å†™æ•°ï¿???????
-    input [31:0] inst_sram_rdata        //è¯»åˆ°çš„æ•°ï¿???????-inst
-*/
-
-assign inst_sram_en = pre_if_to_fs_valid && ds_allow_in;
-assign inst_sram_wen = 4'b0;    //fetché˜¶æ®µä¸å†™
-assign inst_sram_addr = next_pc;
-assign inst_sram_wdata = 32'b0;
-
-/*----------------------------------------------------------------*/
-
-/*----------------------------å‘ï¿½?ï¿½fs_to_ds_bus------------------------*/
-//è¦ï¿½?ï¿½å¾€decodeé˜¶æ®µçš„æ•°æ®æœ‰PCä¸INST
-//pcä¸instï¿???????32ä½ï¼Œå› æ­¤fs_to_ds_busï¿???????64ï¿???????
-wire [31:0] fetch_inst;
-assign fetch_inst = inst_sram_rdata;
-assign fs_to_ds_bus = {fetch_inst,fetch_pc};
-
-/*----------------------------------------------------------------*/
-
-endmodule
-
-module stage2_ID(
-    input clk,
-    input reset,
-
-    input es_allow_in,
-    output ds_allow_in,
-
-    input fs_to_ds_valid,
-    output ds_to_es_valid, 
-
-    input [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
-    output [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
-
-    //ws_to_ds_bus æ‰¿è½½ å¯„å­˜å™¨çš„å†™ä¿¡å·ï¼Œå†™åœ°ï¿??????ä¸å†™æ•°æ®
-    //ä»wbacké˜¶æ®µ é€æ¥ decodeé˜¶æ®µ 
-    input [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus,
-    //br_bus æ‰¿è½½ br_taken ï¿?????? br_target 
-    //ä»decodeé˜¶æ®µ é€å¾€ fetché˜¶æ®µ
-    output [`WIDTH_BR_BUS-1:0] br_bus,
-
-    input [`WIDTH_ES_TO_DS_BUS-1:0] es_to_ds_bus,
-    input [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ds_bus
-);
-
-/*-------------------------è§£ç åŠæ§åˆ¶ä¿¡ï¿??????--------------------------*/
-wire [31:0] inst;
-
-wire        br_taken;
-wire [31:0] br_target;
-
-wire [11:0] alu_op;
-wire        load_op;
-wire        src1_is_pc;
-wire        src2_is_imm;
-wire        res_from_mem;
-wire        dst_is_r1;
-wire        gr_we;
-wire        mem_we;
-wire        src_reg_is_rd;
-wire [4: 0] dest;
-wire [31:0] rj_value;
-wire [31:0] rkd_value;
-wire [31:0] imm;
-wire [31:0] br_offs;
-wire [31:0] jirl_offs;
-
-wire [ 5:0] op_31_26;
-wire [ 3:0] op_25_22;
-wire [ 1:0] op_21_20;
-wire [ 4:0] op_19_15;
-wire [ 4:0] rd;
-wire [ 4:0] rj;
-wire [ 4:0] rk;
-wire [11:0] i12;
-wire [19:0] i20;
-wire [15:0] i16;
-wire [25:0] i26;
-
-wire [63:0] op_31_26_d;
-wire [15:0] op_25_22_d;
-wire [ 3:0] op_21_20_d;
-wire [31:0] op_19_15_d;
-
-wire        inst_add_w;
-wire        inst_sub_w;
-wire        inst_slt;
-wire        inst_sltu;
-wire        inst_nor;
-wire        inst_and;
-wire        inst_or;
-wire        inst_xor;
-wire        inst_slli_w;
-wire        inst_srli_w;
-wire        inst_srai_w;
-wire        inst_addi_w;
-wire        inst_ld_w;
-wire        inst_st_w;
-wire        inst_jirl;
-wire        inst_b;
-wire        inst_bl;
-wire        inst_beq;
-wire        inst_bne;
-wire        inst_lu12i_w;
-
-wire        need_ui5;
-wire        need_si12;
-wire        need_si16;
-wire        need_si20;
-wire        need_si26;
-wire        src2_is_4;
-
-wire [ 4:0] rf_raddr1;
-wire [31:0] rf_rdata1;
-wire [ 4:0] rf_raddr2;
-wire [31:0] rf_rdata2;
-
-assign op_31_26  = inst[31:26];     //checked
-assign op_25_22  = inst[25:22];     //checked
-assign op_21_20  = inst[21:20];     //checked
-assign op_19_15  = inst[19:15];     //checked
-
-assign rd   = inst[ 4: 0];  //checked
-assign rj   = inst[ 9: 5];  //checked
-assign rk   = inst[14:10];  //checked
-
-assign i12  = inst[21:10];  //checked
-assign i20  = inst[24: 5];  //checked
-assign i16  = inst[25:10];  //checked
-assign i26  = {inst[ 9: 0], inst[25:10]};   //checked  !!!æ³¨æ„BæŒ‡ä»¤çš„ç«‹å³æ•°é«˜ä½ä½æ˜¯åçš„
-
-decoder_6_64 u_dec0(.in(op_31_26 ), .out(op_31_26_d ));
-decoder_4_16 u_dec1(.in(op_25_22 ), .out(op_25_22_d ));
-decoder_2_4  u_dec2(.in(op_21_20 ), .out(op_21_20_d ));
-decoder_5_32 u_dec3(.in(op_19_15 ), .out(op_19_15_d ));
-
-//add_w: rd = rj + rk   asm: add.w rd, rj, rk
-assign inst_add_w  = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h00];
-//sun_w: rd = rj - rk   asm: sub.w rd, rj, rk
-assign inst_sub_w  = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h02];
-//slt: rd = (signed(rj) < signed(rk)) ? 1 : 0  (è§†ä½œæœ‰ç¬¦å·æ•´æ•°æ¯”è¾ƒå¤§ï¿??????)
-//asm: slt rd, rj, rk
-assign inst_slt    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h04];
-//sltu: rd = (unsigned(rj) < unsigned(rk)) ? 1 : 0  (è§†ä½œæ— ç¬¦å·æ•´æ•°æ¯”è¾ƒå¤§ï¿??????)
-//asm: sltu rd, rj, rk
-assign inst_sltu   = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h05];
-//nor: rd = ~(rj | rk)   asm: nor rd, rj, rk
-assign inst_nor    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h08];
-//and: rd = rj & rk  asm: and rd, rj, rk
-assign inst_and    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h09];
-//or: rd = rj | rk  asm: or rd, rj, rk
-assign inst_or     = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h0a];
-//xor: rd = rj ^ rk  asm: xor rd, rj, rk
-assign inst_xor    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h0b];
-//slli.w: rd = SLL(rj, ui5)  asm: slli.w rd, rj, ui5
-//rjä¸­çš„æ•°ï¿½?ï¿½è¾‘å·¦ç§»å†™å…¥rd
-assign inst_slli_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h01];
-//srli.w: rd = SRL(rj, ui5)  asm: srli.w rd, rj, ui5
-//rjä¸­çš„æ•°ï¿½?ï¿½è¾‘å³ç§»å†™å…¥rd
-assign inst_srli_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h09];
-//srai.w: rd = SRA(rj, ui5)  asm: srai.w rd, rj, ui5
-//rjä¸­çš„æ•°ç®—æ•°å³ç§»å†™å…¥rd
-assign inst_srai_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h11];
-//addi.w: rd = rj + SignExtend(si12, 32)  asm: addi.w rd, rj, si12
-assign inst_addi_w = op_31_26_d[6'h00] & op_25_22_d[4'ha];
-//ld_w: ld.w rd, rj, si12
-//vaddr = rj + SignExtend(si12, GRLEN)
-//paddr = AddressTranslation(vaddr)
-//word = MemoryLoad(paddr, WORD)
-//rd = word
-assign inst_ld_w   = op_31_26_d[6'h0a] & op_25_22_d[4'h2];
-//st_w: st.w rd, rj, si12
-//vaddr = rj + SignExtend(si12, GRLEN)
-//paddr = AddressTranlation(vaddr)
-//rd --> Mem(paddr)(len:WORD)
-assign inst_st_w   = op_31_26_d[6'h0a] & op_25_22_d[4'h6];
-//jirl: rd, rj, offs16
-//rd = pc + 4
-//pc = rj + SignExtend({offs16, 2'b0}, GRLEN)
-assign inst_jirl   = op_31_26_d[6'h13];
-//b: b offs26
-//pc = pc + SignExtend({offs26, 2'b0}, GRLEN)
-assign inst_b      = op_31_26_d[6'h14];
-//bl: bl offs26
-//GR[1] = pc + 4
-//pc = pc + SignExtend({offs26, 2'b0}, GRLEN)
-assign inst_bl     = op_31_26_d[6'h15];
-//beq: rj, rd, offs16
-//if (rj==rd)
-//  pc = pc + SignExtend({offs16, 2'b0}, GRLEN)
-assign inst_beq    = op_31_26_d[6'h16];
-//bne: rj, rd, offs16
-//if (rj==rd)
-//  pc = pc + SignExtend({offs16, 2'b0}, GRLEN)
-assign inst_bne    = op_31_26_d[6'h17];
-//lui2i_w: rd, si20
-//rd = {si20, 12'b0}
-assign inst_lu12i_w= op_31_26_d[6'h05] & ~inst[25];
-
-//ä½¿ç”¨ç«‹å³æ•°ç§ç±»ï¿½?ï¿½æ‹©
-assign need_ui5   =  inst_slli_w | inst_srli_w | inst_srai_w;  
-assign need_si12  =  inst_addi_w | inst_ld_w | inst_st_w;   
-assign need_si16  =  inst_jirl | inst_beq | inst_bne;       
-assign need_si20  =  inst_lu12i_w;          
-assign need_si26  =  inst_b | inst_bl;      
-//åŠ æ³•å™¨ç¬¬äºŒä¸ªæ“ä½œæ•°ï¿½?ï¿½æ‹©â€”ï¿½?ï¿½æ˜¯å¦ä¸º4
-assign src2_is_4  =  inst_jirl | inst_bl;   
-
-//branchçš„è·³è½¬åœ°ï¿??????ç›®å‰åªæœ‰ä¸¤ç§â€”ï¿½?ï¿½si26ä¸si16
-assign br_offs = need_si26 ? {{ 4{i26[25]}}, i26[25:0], 2'b0} :   
-                             {{14{i16[15]}}, i16[15:0], 2'b0} ;   
-//jirl_offså•ç‹¬åˆ—å‡ºä¸»è¦æ˜¯å› ä¸ºå®ƒä¸æ˜¯bç±»å‹æŒ‡ä»¤ï¼Œä¹Ÿæ–¹ä¾¿ååºæ‹“å±•
-assign jirl_offs = {{14{i16[15]}}, i16[15:0], 2'b0};   
-
-//src_reg_is_rdä»£è¡¨reg_fileç¬¬äºŒä¸ªè¯»ç«¯å£æ˜¯å¦æ¥rdï¼Œå¦åˆ™æ¥rk
-assign src_reg_is_rd = inst_beq | inst_bne | inst_st_w;
-
-//used for judging br_taken
-assign rj_eq_rd = (rj_value == rkd_value);
-
-/*----------------------------------------------------------------*/
-
-/*-----------------------æ¥æ”¶fs_to_ds_bus----------------*/
-//wire [31:0] inst; å®šä¹‰åœ¨å‰ï¿?????   
-wire [31:0] ds_pc;
-
-reg [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus_reg;
-always @(posedge clk)
-    begin
-        if(reset)
-            fs_to_ds_bus_reg <= 0;
-        else if(fs_to_ds_valid && ds_allow_in)         
-            fs_to_ds_bus_reg <= fs_to_ds_bus;
-    end
-assign {inst,ds_pc} = fs_to_ds_bus_reg;         //_reg;
-/*-------------------------------------------------------*/
-
-/*-----------------------æ¥æ”¶es,ms,ws_to_ds_bus----------------*/
-wire rf_we;
-wire [4:0] rf_waddr;
-wire [31:0] rf_wdata;
-assign {rf_we,rf_waddr,rf_wdata} = ws_to_ds_bus;
-
-wire es_we;
-wire [4:0] es_dest;
-wire IF_LOAD;
-wire [31:0] es_wdata;
-wire ms_we;
-wire [4:0] ms_dest;
-wire [31:0] ms_wdata;
-
-assign {es_we,es_dest,IF_LOAD,es_wdata} = es_to_ds_bus;
-assign {ms_we,ms_dest,ms_wdata} = ms_to_ds_bus;
-/*-------------------------------------------------------*/
-
-/*-----------------------å‘ï¿½?ï¿½br_bus----------------------*/
-assign br_taken = ((inst_beq && rj_eq_rd) || (inst_bne && !rj_eq_rd)   
-                   || inst_jirl || inst_bl || inst_b) && ds_valid;
-
-wire br_taken_cancel;
-//assign br_taken_cancel = (inst_beq || inst_bne || inst_jirl || inst_bl || inst_b) && ds_valid;
-
-assign br_target = (inst_beq || inst_bne || inst_bl || inst_b) ? (ds_pc + br_offs) :   
-                                                   /*inst_jirl*/ (rj_value + jirl_offs); 
-assign br_bus = {br_taken_cancel,br_taken,br_target};           
-/*-------------------------------------------------------*/
-
-/*-----------------------å‘ï¿½?ï¿½ds_to_es_bus----------------*/
-assign rj_value  = forward_rdata1;   
-assign rkd_value = forward_rdata2;   
-assign imm = src2_is_4 ? 32'h4                      :   
-             need_si20 ? {i20[19:0], 12'b0}         :   
-             need_ui5  ? {27'b0,rk[4:0]}            :   
-             need_si12 ? {{20{i12[11]}}, i12[11:0]} :   
-             32'b0 ;
-assign dst_is_r1     = inst_bl;     //ä¸éœ€é€å‡ºï¼Œåªæ˜¯è¾…åŠ©dest
-assign dest = dst_is_r1 ? 5'd1 : rd;
-assign gr_we         = ~inst_st_w & ~inst_beq & ~inst_bne & ~inst_b;   
-assign mem_we        = inst_st_w;
-
-assign alu_op[ 0] = inst_add_w | inst_addi_w | inst_ld_w | inst_st_w
-                    | inst_jirl | inst_bl;
-assign alu_op[ 1] = inst_sub_w;
-assign alu_op[ 2] = inst_slt;
-assign alu_op[ 3] = inst_sltu;
-assign alu_op[ 4] = inst_and;
-assign alu_op[ 5] = inst_nor;
-assign alu_op[ 6] = inst_or;
-assign alu_op[ 7] = inst_xor;
-assign alu_op[ 8] = inst_slli_w;
-assign alu_op[ 9] = inst_srli_w;
-assign alu_op[10] = inst_srai_w;
-assign alu_op[11] = inst_lu12i_w;
-
-assign src1_is_pc    = inst_jirl | inst_bl; //checked
-
-assign src2_is_imm   = inst_slli_w |    //checked
-                       inst_srli_w |
-                       inst_srai_w |
-                       inst_addi_w |
-                       inst_ld_w   |
-                       inst_st_w   |
-                       inst_lu12i_w|
-                       inst_jirl   |
-                       inst_bl     ;    
-
-assign res_from_mem  = inst_ld_w;
-
-assign ds_to_es_bus[31:   0] = ds_pc;        //pcï¿½ï¿½ï¿½ï¿½fetchï¿½ï¿½???ï¿½ï¿½execute
-assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data1
-assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data2
-assign ds_to_es_bus[127: 96] = imm;       //Ñ¡ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿??????
-assign ds_to_es_bus[132:128] = dest;      //Ğ´ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿????
-assign ds_to_es_bus[133:133] = gr_we;     //ï¿½Ç·ï¿½Ğ´ï¿½Ä´ï¿½ï¿½ï¿½
-assign ds_to_es_bus[134:134] = mem_we;    //ï¿½Ç·ï¿½Ğ´ï¿½ï¿½??
-assign ds_to_es_bus[146:135] = alu_op;    //aluï¿½ï¿½ï¿½ï¿½??
-assign ds_to_es_bus[147:147] = src1_is_pc;   //ï¿½ï¿½ï¿½ï¿½??1ï¿½Ç·ï¿½Îªpc
-assign ds_to_es_bus[148:148] = src2_is_imm;  //ï¿½ï¿½ï¿½ï¿½??2ï¿½Ç·ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
-assign ds_to_es_bus[149:149] = res_from_mem; //Ğ´ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú´ï¿????
-/*-------------------------------------------------------*/
-
-/*--------------------------------valid---------------------------*/
-reg ds_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿??????
-//å¤„ç†å†™åè¯»å†²ï¿???
-wire if_read_addr1;   //ï¿½Ç·ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½addr1
-wire if_read_addr2;   //ï¿½Ç·ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½addr2
-
-assign if_read_addr1 = ~inst_b && ~inst_bl;
-assign if_read_addr2 = inst_beq || inst_bne || inst_xor || inst_or || inst_and || inst_nor ||
-                       inst_sltu || inst_slt || inst_sub_w || inst_add_w || inst_st_w;
-
-wire Need_Block;    //ex_crush & IF_LOAD
-
-assign Need_Block = (ex_crush1 || ex_crush2) && IF_LOAD;
-
-wire ex_crush1;
-wire ex_crush2;
-assign ex_crush1 = (es_we && es_dest!=0) && (if_read_addr1 && rf_raddr1==es_dest);
-assign ex_crush2 = (es_we && es_dest!=0) && (if_read_addr2 && rf_raddr2==es_dest);
-
-wire mem_crush1;
-wire mem_crush2;
-assign mem_crush1 = (ms_we && ms_dest!=0) && (if_read_addr1 && rf_raddr1==ms_dest);
-assign mem_crush2 = (ms_we && ms_dest!=0) && (if_read_addr2 && rf_raddr2==ms_dest);
-
-wire wb_crush1;
-wire wb_crush2;
-assign wb_crush1 = (rf_we && rf_waddr!=0) && (if_read_addr1 && rf_raddr1==rf_waddr);
-assign wb_crush2 = (rf_we && rf_waddr!=0) && (if_read_addr2 && rf_raddr2==rf_waddr);
-
-//forward deliver
-wire [31:0] forward_rdata1;
-wire [31:0] forward_rdata2;
-assign forward_rdata1 = ex_crush1? es_wdata : mem_crush1? ms_wdata : wb_crush1? rf_wdata : rf_rdata1;
-assign forward_rdata2 = ex_crush2? es_wdata : mem_crush2? ms_wdata : wb_crush2? rf_wdata : rf_rdata2;
-
-wire ds_ready_go;
-assign ds_ready_go = ~Need_Block;         
-assign ds_allow_in = !ds_valid || ds_ready_go && es_allow_in;
-assign ds_to_es_valid = ds_valid && ds_ready_go;
-
-//å½“æ•°æ®å†²çªï¼Œds_ready_goæ‹‰ä½ï¼Œds_allow_inå¯¹åº”æ‹‰ä½ï¼Œds_to_es_validå¯¹åº”æ‹‰ä½
-
-assign br_taken_cancel =  Need_Block ? 1'b0 : br_taken;
-
-always @(posedge clk)
-    begin
-        if(reset)
-            ds_valid <= 1'b0;
-        else if(br_taken_cancel)
-            ds_valid <= 1'b0;
-        else if(ds_allow_in)
-            ds_valid <= fs_to_ds_valid;
-    end
-/*----------------------------------------------------------------*/
-
-/*-------------------------ä¸regfileæ¥å£---------------------------*/
-assign rf_raddr1 = rj;  
-assign rf_raddr2 = src_reg_is_rd ? rd : rk; 
-regfile u_regfile(
-    .clk    (clk      ),   
-    .raddr1 (rf_raddr1),    
-    .rdata1 (rf_rdata1),    
-    .raddr2 (rf_raddr2),    
-    .rdata2 (rf_rdata2),    
-    .we     (rf_we    ),    
-    .waddr  (rf_waddr ),    
-    .wdata  (rf_wdata )     
-    );
-/*
-assign {rf_we,rf_waddr,rf_wdata} = ws_to_ds_bus;
-æ„åœ¨å¼ºè°ƒæé†’æ­¤æ—¶çš„weï¼Œwaddrå’Œwdataæ¥è‡ªwbé˜¶æ®µå‘æ¥çš„ä¿¡ï¿??????
-*/
-/*----------------------------------------------------------------*/
-
-endmodule
-
-module stage3_EX(
-    input clk,
-    input reset,
-
-    input ms_allow_in,
-    output es_allow_in,
-
-    input ds_to_es_valid,
-    output es_to_ms_valid,
-
-    input [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
-    output [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
-    output [`WIDTH_ES_TO_DS_BUS-1:0] es_to_ds_bus,
-
-    output data_sram_en,
-    output [3:0]data_sram_wen,
-    output [31:0] data_sram_addr,
-    output [31:0] data_sram_wdata
-);
-
-/*-----------------------æ¥æ”¶ds_to_es_bus----------------*/
-/*
-assign ds_to_es_bus[31:   0] = ds_pc;        //pcï¿½ï¿½ï¿½ï¿½fetchï¿½ï¿½???ï¿½ï¿½execute
-assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data1
-assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data2
-assign ds_to_es_bus[127: 96] = imm;       //Ñ¡ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿??????
-assign ds_to_es_bus[132:128] = dest;      //Ğ´ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿????
-assign ds_to_es_bus[133:133] = gr_we;     //ï¿½Ç·ï¿½Ğ´ï¿½Ä´ï¿½ï¿½ï¿½
-assign ds_to_es_bus[134:134] = mem_we;    //ï¿½Ç·ï¿½Ğ´ï¿½ï¿½??
-assign ds_to_es_bus[146:135] = alu_op;    //aluï¿½ï¿½ï¿½ï¿½??
-assign ds_to_es_bus[147:147] = src1_is_pc;   //ï¿½ï¿½ï¿½ï¿½??1ï¿½Ç·ï¿½Îªpc
-assign ds_to_es_bus[148:148] = src2_is_imm;  //ï¿½ï¿½ï¿½ï¿½??2ï¿½Ç·ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
-assign ds_to_es_bus[149:149] = res_from_mem; //Ğ´ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú´ï¿????
-*/
-wire [31:0] es_pc;
-wire [31:0] es_rj_value;
-wire [31:0] es_rkd_value;
-wire [31:0] es_imm;
-wire [4:0]  es_dest;
-wire        es_gr_we;
-wire        es_mem_we;
-wire [11:0] es_alu_op;
-wire        es_src1_is_pc;
-wire        es_src2_is_imm;
-wire        es_res_from_mem;
-
-reg [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus_reg;
-always @(posedge clk)
-    begin
-        if(reset)
-            ds_to_es_bus_reg <= 0;
-        else if(ds_to_es_valid && es_allow_in)
-            ds_to_es_bus_reg <= ds_to_es_bus;
-        else
-            ds_to_es_bus_reg <= 0; 
-    end
-
-assign {es_res_from_mem, es_src2_is_imm, es_src1_is_pc,
-        es_alu_op, es_mem_we, es_gr_we, es_dest, es_imm,
-        es_rkd_value, es_rj_value, es_pc} = ds_to_es_bus_reg;
-/*-------------------------------------------------------*/
-
-/*-----------------------å‘ï¿½?ï¿½es_to_ms_bus----------------*/
-
-wire [31:0] es_alu_result;
-
-assign es_to_ms_bus[31:0] = es_pc;
-assign es_to_ms_bus[32:32] = es_gr_we;
-assign es_to_ms_bus[33:33] = es_res_from_mem;
-assign es_to_ms_bus[38:34] = es_dest;
-assign es_to_ms_bus[70:39] = es_alu_result;
-
-/*-------------------------------------------------------*/
-
-/*-------------------------ä¸aluæ¥å£---------------------*/
-
-//wire [31:0] es_alu_result; åœ¨ä¸Šé¢å®šä¹‰æ˜¯å› ä¸ºä¸Šé¢ç”¨äº†æ­¤ä¿¡ï¿?????
-wire [31:0] alu_src1;
-wire [31:0] alu_src2;
-
-assign alu_src1 = es_src1_is_pc  ? es_pc[31:0] : es_rj_value;   
-assign alu_src2 = es_src2_is_imm ? es_imm : es_rkd_value;        
-
-alu u_alu(
-    .alu_op     (es_alu_op    ),
-    .alu_src1   (alu_src1  ),
-    .alu_src2   (alu_src2  ),
-    .alu_result (es_alu_result)
-    );
-
-/*-------------------------------------------------------*/
-
-
-/*-------------------------valid-------------------------*/
-reg es_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿??????
-
-wire es_ready_go;
-assign es_ready_go = 1'b1;
-assign es_allow_in = !es_valid || es_ready_go && ms_allow_in;
-assign es_to_ms_valid = es_valid && es_ready_go;
-
-always @(posedge clk)
-    begin
-        if(reset)
-            es_valid <= 1'b0;
-        else if(es_allow_in)
-            es_valid <= ds_to_es_valid;
-    end
-
-/*-------------------------------------------------------*/
-
-/*----------------------ä¸data_sramæ¥å£-------------------*/
-assign data_sram_en    = 1'b1;   //æš‚æ—¶æ˜¯å§‹ç»ˆå¯è¯»çš„
-assign data_sram_wen   = (es_mem_we && es_valid) ? 4'b1111 : 4'b0000;
-assign data_sram_addr  = es_alu_result;
-assign data_sram_wdata = es_rkd_value;        //st_wæŒ‡ä»¤å†™çš„æ˜¯rdçš„value
-/*--------------------------------------------------------*/
-
-/*-----------------------å‘ï¿½?ï¿½es_to_ds_bus----------------*/
-wire IF_LOAD;   //æ˜¯å¦loadæŒ‡ä»¤ï¼Œå¦‚æœæ˜¯loadæŒ‡ä»¤ï¼Œå‰é€’ä»ç„¶è¦é˜»å¡ä¸€ä¸ªå‘¨æœ?
-assign IF_LOAD = es_res_from_mem;
-assign es_to_ds_bus = {es_gr_we,es_dest,IF_LOAD,es_alu_result};
-
-/*-------------------------------------------------------*/
-
-endmodule
-
-module stage4_MEM(
-    input clk,
-    input reset,
-
-    input ws_allow_in,
-    output ms_allow_in,
-
-    input es_to_ms_valid,
-    output ms_to_ws_valid,
-
-    input [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
-    output [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
-    output [`WIDTH_MS_TO_DS_BUS-1:0] ms_to_ds_bus,
-    
-    input [31:0] data_sram_rdata
-);
-
-/*-----------------------æ¥æ”¶es_to_ms_bus----------------*/
-/*
-assign es_to_ms_bus[31:0] = es_pc;
-assign es_to_ms_bus[32:32] = es_gr_we;
-assign es_to_ms_bus[33:33] = es_res_from_mem;
-assign es_to_ms_bus[38:34] = es_dest;
-assign es_to_ms_bus[70:39] = es_alu_result;
-*/
-
-wire [31:0] ms_pc;
-wire ms_gr_we;
-wire ms_res_from_mem;
-wire [4:0] ms_dest;
-wire [31:0] ms_alu_result;
-
-reg [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus_reg;
-always @(posedge clk)
-    begin
-        if(reset)
-            es_to_ms_bus_reg <= 0;
-        else if(es_to_ms_valid && ms_allow_in)
-            es_to_ms_bus_reg <= es_to_ms_bus;
-        else
-            es_to_ms_bus_reg <= 0;
-    end 
-
-assign {ms_alu_result, ms_dest, ms_res_from_mem,
-        ms_gr_we, ms_pc} = es_to_ms_bus_reg;
-
-/*-------------------------------------------------------*/
-
-/*----------------------å‘ï¿½?ï¿½ms_to_ws_bus-----------------*/
-wire [31:0] mem_result;
-assign mem_result   = data_sram_rdata;
-wire [31:0] ms_final_result;
-assign ms_final_result = ms_res_from_mem? mem_result : ms_alu_result;
-
-assign ms_to_ws_bus[31:0]  = ms_pc;
-assign ms_to_ws_bus[32:32] = ms_gr_we;
-assign ms_to_ws_bus[37:33] = ms_dest;
-assign ms_to_ws_bus[69:38] = ms_final_result;
-/*-------------------------------------------------------*/
-
-/*--------------------------valid------------------------*/
-reg ms_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿?????
-
-wire ms_ready_go;
-assign ms_ready_go = 1'b1;
-assign ms_allow_in = !ms_valid || ms_ready_go && ws_allow_in;
-assign ms_to_ws_valid = ms_valid && ms_ready_go;
-
-always @(posedge clk)
-    begin
-        if(reset)
-            ms_valid <= 1'b0;
-        else if(ms_allow_in)
-            ms_valid <= es_to_ms_valid;
-    end
-
-/*-------------------------------------------------------*/
-
-/*--------------------å‘ï¿½?ï¿½ms_to_ds_bus-------------------*/
-assign ms_to_ds_bus = {ms_gr_we,ms_dest,ms_final_result};
-/*-------------------------------------------------------*/
-
-endmodule
-
-module stage5_WB(
-    input clk,
-    input reset,
-
-    //no allow in
-    output ws_allow_in,
-
-    input ms_to_ws_valid,
-    //no to valid
-
-    input [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
-    output [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus,
-
-    output [31:0] debug_wb_pc     ,
-    output [ 3:0] debug_wb_rf_we ,
-    output [ 4:0] debug_wb_rf_wnum,
-    output [31:0] debug_wb_rf_wdata
-);
-
-/*-----------------------æ¥æ”¶ms_to_ws_bus----------------*/
-/*
-assign ms_to_ws_bus[31:0]  = ms_pc;
-assign ms_to_ws_bus[32:32] = ms_gr_we;
-assign ms_to_ws_bus[37:33] = ms_dest;
-assign ms_to_ws_bus[69:38] = ms_final_result;
-*/
-
-wire [31:0] ws_pc;
-wire ws_gr_we;
-wire [4:0] ws_dest;
-wire [31:0] ws_final_result;
-
-reg [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus_reg;
-always @(posedge clk)
-    begin
-        if(reset)
-            ms_to_ws_bus_reg <= 0;
-        else if(ms_to_ws_valid && ws_allow_in)
-            ms_to_ws_bus_reg <= ms_to_ws_bus;
-        else
-            ms_to_ws_bus_reg <= 0;
-    end 
-
-assign {ws_final_result, ws_dest,
-        ws_gr_we, ws_pc} = ms_to_ws_bus_reg;
-
-/*-------------------------------------------------------*/
-
-/*----------------------å‘ï¿½?ï¿½ws_to_ds_bus-----------------*/
-
-reg ws_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿?????
-
-wire ws_we;
-assign ws_we = ws_gr_we && ws_valid;
-wire [4:0] ws_waddr;
-assign ws_waddr = ws_dest;
-wire [31:0] ws_wdata;
-assign ws_wdata = ws_final_result;
-
-assign ws_to_ds_bus[31:0] = ws_wdata;
-assign ws_to_ds_bus[36:32] = ws_waddr;
-assign ws_to_ds_bus[37:37] = ws_we;
-
-/*-------------------------------------------------------*/
-
-/*--------------------------valid------------------------*/
-//reg ws_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œåœ¨ä¸Šé¢å®šä¹‰æ˜¯å› ä¸ºä¸Šé¢ç”¨äº†æ­¤ä¿¡ï¿?????
-wire ws_ready_go;
-assign ws_ready_go = 1'b1;
-assign ws_allow_in = !ws_valid || ws_ready_go;
-
-always @(posedge clk)
-    begin
-        if(reset)
-            ws_valid <= 1'b0;
-        else if(ws_allow_in)
-            ws_valid <= ms_to_ws_valid;
-    end
-
-/*-------------------------------------------------------*/
-
-/*--------------------------debug reference--------------*/
-assign debug_wb_pc       = ws_pc;
-assign debug_wb_rf_we   = {4{ws_we}};
-assign debug_wb_rf_wnum  = ws_dest;
-assign debug_wb_rf_wdata = ws_final_result;
-/*-------------------------------------------------------*/
-
-endmodule
\ No newline at end of file
diff --git a/cyt_code/for_patch/EX.v b/cyt_code/for_patch/EX.v
index dd5c963..4df3d2d 100644
--- a/cyt_code/for_patch/EX.v
+++ b/cyt_code/for_patch/EX.v
@@ -1,11 +1,11 @@
-`define WIDTH_BR_BUS       33
+`define WIDTH_BR_BUS       34
 `define WIDTH_FS_TO_DS_BUS 64
 `define WIDTH_DS_TO_ES_BUS 150
 `define WIDTH_ES_TO_MS_BUS 71
 `define WIDTH_MS_TO_WS_BUS 70
 `define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 6
-`define WIDTH_MS_TO_DS_BUS 6
+`define WIDTH_ES_TO_DS_BUS 39
+`define WIDTH_MS_TO_DS_BUS 38
 
 module stage3_EX(
     input clk,
@@ -27,19 +27,19 @@ module stage3_EX(
     output [31:0] data_sram_wdata
 );
 
-/*-----------------------æ¥æ”¶ds_to_es_bus----------------*/
+/*-----------------------éºãƒ¦æ•¹ds_to_es_bus----------------*/
 /*
-assign ds_to_es_bus[31:   0] = ds_pc;        //pcï¿½ï¿½ï¿½ï¿½fetchï¿½ï¿½???ï¿½ï¿½execute
-assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data1
-assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data2
-assign ds_to_es_bus[127: 96] = imm;       //Ñ¡ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿½?????
-assign ds_to_es_bus[132:128] = dest;      //Ğ´ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½???
-assign ds_to_es_bus[133:133] = gr_we;     //ï¿½Ç·ï¿½Ğ´ï¿½Ä´ï¿½ï¿½ï¿½
-assign ds_to_es_bus[134:134] = mem_we;    //ï¿½Ç·ï¿½Ğ´ï¿½ï¿½??
-assign ds_to_es_bus[146:135] = alu_op;    //aluï¿½ï¿½ï¿½ï¿½??
-assign ds_to_es_bus[147:147] = src1_is_pc;   //ï¿½ï¿½ï¿½ï¿½??1ï¿½Ç·ï¿½Îªpc
-assign ds_to_es_bus[148:148] = src2_is_imm;  //ï¿½ï¿½ï¿½ï¿½??2ï¿½Ç·ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
-assign ds_to_es_bus[149:149] = res_from_mem; //Ğ´ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú´ï¿½???
+assign ds_to_es_bus[31:   0] = ds_pc;        //pcé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·fetché”Ÿæ–¤æ‹·???é”Ÿæ–¤æ‹·execute
+assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·data1
+assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·data2
+assign ds_to_es_bus[127: 96] = imm;       //é€‰é”Ÿæ–¤æ‹·ç«é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿï¿½?????
+assign ds_to_es_bus[132:128] = dest;      //å†™é”Ÿæ–¤æ‹·æ‹‡é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿï¿½???
+assign ds_to_es_bus[133:133] = gr_we;     //é”Ÿè§’å‡¤æ‹·å†™é”Ÿä¾¥è¾¾æ‹·é”Ÿæ–¤æ‹·
+assign ds_to_es_bus[134:134] = mem_we;    //é”Ÿè§’å‡¤æ‹·å†™é”Ÿæ–¤æ‹·??
+assign ds_to_es_bus[146:135] = alu_op;    //alué”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??
+assign ds_to_es_bus[147:147] = src1_is_pc;   //é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??1é”Ÿè§’å‡¤æ‹·ä¸ºpc
+assign ds_to_es_bus[148:148] = src2_is_imm;  //é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??2é”Ÿè§’å‡¤æ‹·ä¸ºé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·
+assign ds_to_es_bus[149:149] = res_from_mem; //å†™é”Ÿä¾¥è¾¾æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·æ¬ é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·è¯–é”Ÿï¿½???
 */
 wire [31:0] es_pc;
 wire [31:0] es_rj_value;
@@ -69,7 +69,7 @@ assign {es_res_from_mem, es_src2_is_imm, es_src1_is_pc,
         es_rkd_value, es_rj_value, es_pc} = ds_to_es_bus_reg;
 /*-------------------------------------------------------*/
 
-/*-----------------------å‘ï¿½?ï¿½es_to_ms_bus----------------*/
+/*-----------------------é™æˆ¯æ‹·?é”Ÿçµœs_to_ms_bus----------------*/
 
 wire [31:0] es_alu_result;
 
@@ -81,9 +81,9 @@ assign es_to_ms_bus[70:39] = es_alu_result;
 
 /*-------------------------------------------------------*/
 
-/*-------------------------ä¸aluæ¥å£---------------------*/
+/*-------------------------æ¶“å·ƒluéºãƒ¥å½›---------------------*/
 
-//wire [31:0] es_alu_result; åœ¨ä¸Šé¢å®šä¹‰æ˜¯å› ä¸ºä¸Šé¢ç”¨äº†æ­¤ä¿¡ï¿½????
+//wire [31:0] es_alu_result; é¦ã„¤ç¬‚é—ˆãˆ ç•¾æ¶”å¤‹æ§¸é¥çŠ±è´Ÿæ¶“å©‡æ½°é¢ã„¤ç°¡å§ã‚„ä¿Šé”Ÿï¿½????
 wire [31:0] alu_src1;
 wire [31:0] alu_src2;
 
@@ -101,7 +101,7 @@ alu u_alu(
 
 
 /*-------------------------valid-------------------------*/
-reg es_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿½?????
+reg es_valid;    //validæ·‡â€³å½¿ç›ã„§ãšæ©æ¬ç«´ç»¾Ñ„ç¥¦å§˜å¯¸ç´¦ç€›æ¨»æ§¸éšï¸½æ¹é”Ÿï¿½?????
 
 wire es_ready_go;
 assign es_ready_go = 1'b1;
@@ -118,15 +118,17 @@ always @(posedge clk)
 
 /*-------------------------------------------------------*/
 
-/*----------------------ä¸data_sramæ¥å£-------------------*/
-assign data_sram_en    = 1'b1;   //æš‚æ—¶æ˜¯å§‹ç»ˆå¯è¯»çš„
+/*----------------------æ¶“å·‡ata_sraméºãƒ¥å½›-------------------*/
+assign data_sram_en    = 1'b1;   //é†å‚›æ¤‚é„îˆšîç¼å å½²ç’‡è¤æ®‘
 assign data_sram_wen   = (es_mem_we && es_valid) ? 4'b1111 : 4'b0000;
 assign data_sram_addr  = es_alu_result;
-assign data_sram_wdata = es_rkd_value;        //st_wæŒ‡ä»¤å†™çš„æ˜¯rdçš„value
+assign data_sram_wdata = es_rkd_value;        //st_wé¸å›¦æŠ¤éæ¬‘æ®‘é„ç—³dé¨å‰‰alue
 /*--------------------------------------------------------*/
 
-/*-----------------------å‘ï¿½?ï¿½es_to_ds_bus----------------*/
-assign es_to_ds_bus = {es_gr_we,es_dest};
+/*-----------------------é™æˆ¯æ‹·?é”Ÿçµœs_to_ds_bus----------------*/
+wire IF_LOAD;   //é„îˆšæƒloadé¸å›¦æŠ¤é”›å±½î›§é‹æ»„æ§¸loadé¸å›¦æŠ¤é”›å±½å¢ é–«æç²›é’æƒ°î›¦é—ƒè¯²î”£æ¶“â‚¬æ¶“î„æ‡†éˆï¿½
+assign IF_LOAD = es_res_from_mem;
+assign es_to_ds_bus = {es_gr_we,es_dest,IF_LOAD,es_alu_result};
 
 /*-------------------------------------------------------*/
 
diff --git a/cyt_code/for_patch/ID.v b/cyt_code/for_patch/ID.v
index 3eb3b1f..da85cae 100644
--- a/cyt_code/for_patch/ID.v
+++ b/cyt_code/for_patch/ID.v
@@ -1,11 +1,11 @@
-`define WIDTH_BR_BUS       33
+`define WIDTH_BR_BUS       34
 `define WIDTH_FS_TO_DS_BUS 64
 `define WIDTH_DS_TO_ES_BUS 150
 `define WIDTH_ES_TO_MS_BUS 71
 `define WIDTH_MS_TO_WS_BUS 70
 `define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 6
-`define WIDTH_MS_TO_DS_BUS 6
+`define WIDTH_ES_TO_DS_BUS 39
+`define WIDTH_MS_TO_DS_BUS 38
 
 module stage2_ID(
     input clk,
@@ -20,18 +20,18 @@ module stage2_ID(
     input [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
     output [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
 
-    //ws_to_ds_bus æ‰¿è½½ å¯„å­˜å™¨çš„å†™ä¿¡å·ï¼Œå†™åœ°ï¿½?????ä¸å†™æ•°æ®
-    //ä»wbacké˜¶æ®µ é€æ¥ decodeé˜¶æ®µ 
+    //ws_to_ds_bus éµèƒ¯æµ‡ ç€µå‹«ç“¨é£ã„§æ®‘éæ¬ä¿Šé™å‡¤ç´éæ¬æ¹´é”Ÿï¿½?????æ¶“åº¡å•“éç‰ˆåµ
+    //æµ å·œbacké—ƒèˆµî†Œ é–«ä½¹æ½µ decodeé—ƒèˆµî†Œ 
     input [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus,
-    //br_bus æ‰¿è½½ br_taken ï¿½????? br_target 
-    //ä»decodeé˜¶æ®µ é€å¾€ fetché˜¶æ®µ
+    //br_bus éµèƒ¯æµ‡ br_taken é”Ÿï¿½????? br_target 
+    //æµ å·‡ecodeé—ƒèˆµî†Œ é–«ä½¸ç·š fetché—ƒèˆµî†Œ
     output [`WIDTH_BR_BUS-1:0] br_bus,
 
     input [`WIDTH_ES_TO_DS_BUS-1:0] es_to_ds_bus,
     input [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ds_bus
 );
 
-/*-------------------------è§£ç åŠæ§åˆ¶ä¿¡ï¿½?????--------------------------*/
+/*-------------------------ç‘™ï½‡çˆœé™å©ƒå¸¶é’æœµä¿Šé”Ÿï¿½?????--------------------------*/
 wire [31:0] inst;
 
 wire        br_taken;
@@ -115,7 +115,7 @@ assign rk   = inst[14:10];  //checked
 assign i12  = inst[21:10];  //checked
 assign i20  = inst[24: 5];  //checked
 assign i16  = inst[25:10];  //checked
-assign i26  = {inst[ 9: 0], inst[25:10]};   //checked  !!!æ³¨æ„BæŒ‡ä»¤çš„ç«‹å³æ•°é«˜ä½ä½æ˜¯åçš„
+assign i26  = {inst[ 9: 0], inst[25:10]};   //checked  !!!å¨‰ã„¦å‰°Bé¸å›¦æŠ¤é¨å‹­ç›é—è™«æšŸæ¥‚æ¨¹ç¶†æµ£å¶†æ§¸é™å¶‡æ®‘
 
 decoder_6_64 u_dec0(.in(op_31_26 ), .out(op_31_26_d ));
 decoder_4_16 u_dec1(.in(op_25_22 ), .out(op_25_22_d ));
@@ -126,10 +126,10 @@ decoder_5_32 u_dec3(.in(op_19_15 ), .out(op_19_15_d ));
 assign inst_add_w  = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h00];
 //sun_w: rd = rj - rk   asm: sub.w rd, rj, rk
 assign inst_sub_w  = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h02];
-//slt: rd = (signed(rj) < signed(rk)) ? 1 : 0  (è§†ä½œæœ‰ç¬¦å·æ•´æ•°æ¯”è¾ƒå¤§ï¿½?????)
+//slt: rd = (signed(rj) < signed(rk)) ? 1 : 0  (ç‘™å—•ç¶”éˆå¤Œîƒé™é”‹æš£éç‰ˆç˜®æˆå†¨ã‡é”Ÿï¿½?????)
 //asm: slt rd, rj, rk
 assign inst_slt    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h04];
-//sltu: rd = (unsigned(rj) < unsigned(rk)) ? 1 : 0  (è§†ä½œæ— ç¬¦å·æ•´æ•°æ¯”è¾ƒå¤§ï¿½?????)
+//sltu: rd = (unsigned(rj) < unsigned(rk)) ? 1 : 0  (ç‘™å—•ç¶”éƒçŠµîƒé™é”‹æš£éç‰ˆç˜®æˆå†¨ã‡é”Ÿï¿½?????)
 //asm: sltu rd, rj, rk
 assign inst_sltu   = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h05];
 //nor: rd = ~(rj | rk)   asm: nor rd, rj, rk
@@ -141,13 +141,13 @@ assign inst_or     = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & o
 //xor: rd = rj ^ rk  asm: xor rd, rj, rk
 assign inst_xor    = op_31_26_d[6'h00] & op_25_22_d[4'h0] & op_21_20_d[2'h1] & op_19_15_d[5'h0b];
 //slli.w: rd = SLL(rj, ui5)  asm: slli.w rd, rj, ui5
-//rjä¸­çš„æ•°ï¿½?ï¿½è¾‘å·¦ç§»å†™å…¥rd
+//rjæ¶“î… æ®‘éå¸®æ‹·?é”Ÿå€Ÿç·«å®¸ï¸¾Ğ©éæ¬å†rd
 assign inst_slli_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h01];
 //srli.w: rd = SRL(rj, ui5)  asm: srli.w rd, rj, ui5
-//rjä¸­çš„æ•°ï¿½?ï¿½è¾‘å³ç§»å†™å…¥rd
+//rjæ¶“î… æ®‘éå¸®æ‹·?é”Ÿå€Ÿç·«é™å´‡Ğ©éæ¬å†rd
 assign inst_srli_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h09];
 //srai.w: rd = SRA(rj, ui5)  asm: srai.w rd, rj, ui5
-//rjä¸­çš„æ•°ç®—æ•°å³ç§»å†™å…¥rd
+//rjæ¶“î… æ®‘éæ‰®ç•»éæ¿å½¸ç»‰è¯²å•“éî™¸d
 assign inst_srai_w = op_31_26_d[6'h00] & op_25_22_d[4'h1] & op_21_20_d[2'h0] & op_19_15_d[5'h11];
 //addi.w: rd = rj + SignExtend(si12, 32)  asm: addi.w rd, rj, si12
 assign inst_addi_w = op_31_26_d[6'h00] & op_25_22_d[4'ha];
@@ -185,22 +185,22 @@ assign inst_bne    = op_31_26_d[6'h17];
 //rd = {si20, 12'b0}
 assign inst_lu12i_w= op_31_26_d[6'h05] & ~inst[25];
 
-//ä½¿ç”¨ç«‹å³æ•°ç§ç±»ï¿½?ï¿½æ‹©
+//æµ£è·¨æ•¤ç»”å¬ªåµ†éæ‰®î’ç»«ä¼™æ‹·?é”ŸèŠ¥å«¨
 assign need_ui5   =  inst_slli_w | inst_srli_w | inst_srai_w;  
 assign need_si12  =  inst_addi_w | inst_ld_w | inst_st_w;   
 assign need_si16  =  inst_jirl | inst_beq | inst_bne;       
 assign need_si20  =  inst_lu12i_w;          
 assign need_si26  =  inst_b | inst_bl;      
-//åŠ æ³•å™¨ç¬¬äºŒä¸ªæ“ä½œæ•°ï¿½?ï¿½æ‹©â€”ï¿½?ï¿½æ˜¯å¦ä¸º4
+//é”çŠ³ç¡¶é£ã„§îƒ‡æµœå±¼é‡œé¿å¶„ç¶”éå¸®æ‹·?é”ŸèŠ¥å«¨éˆ¥æ—“æ‹·?é”ŸèŠ¥æ§¸éšï¸¿è´Ÿ4
 assign src2_is_4  =  inst_jirl | inst_bl;   
 
-//branchçš„è·³è½¬åœ°ï¿½?????ç›®å‰åªæœ‰ä¸¤ç§â€”ï¿½?ï¿½si26ä¸si16
+//branché¨å‹®çƒ¦æî„€æ¹´é”Ÿï¿½?????é©î†¼å¢ é™î…æ¹æ¶“ã‚‡î’éˆ¥æ—“æ‹·?é”Ÿçµªi26æ¶“å·—i16
 assign br_offs = need_si26 ? {{ 4{i26[25]}}, i26[25:0], 2'b0} :   
                              {{14{i16[15]}}, i16[15:0], 2'b0} ;   
-//jirl_offså•ç‹¬åˆ—å‡ºä¸»è¦æ˜¯å› ä¸ºå®ƒä¸æ˜¯bç±»å‹æŒ‡ä»¤ï¼Œä¹Ÿæ–¹ä¾¿ååºæ‹“å±•
+//jirl_offsé—æ› å«­é’æ¥€åš­æ¶“æ˜î›¦é„îˆšæ´œæ¶“å“„ç• æ¶“å¶†æ§¸bç»«è¯²ç€·é¸å›¦æŠ¤é”›å±¼ç¯ƒé‚é€›ç©¶éšåº¡ç°­é·æ’³ç
 assign jirl_offs = {{14{i16[15]}}, i16[15:0], 2'b0};   
 
-//src_reg_is_rdä»£è¡¨reg_fileç¬¬äºŒä¸ªè¯»ç«¯å£æ˜¯å¦æ¥rdï¼Œå¦åˆ™æ¥rk
+//src_reg_is_rdæµ ï½ˆã€ƒreg_fileç»—îƒ¿ç°©æ¶“î‡î‡°ç»”îˆšå½›é„îˆšæƒéºî™¸dé”›å±½æƒé’æ¬å¸´rk
 assign src_reg_is_rd = inst_beq | inst_bne | inst_st_w;
 
 //used for judging br_taken
@@ -208,8 +208,8 @@ assign rj_eq_rd = (rj_value == rkd_value);
 
 /*----------------------------------------------------------------*/
 
-/*-----------------------æ¥æ”¶fs_to_ds_bus----------------*/
-//wire [31:0] inst; å®šä¹‰åœ¨å‰ï¿½????   
+/*-----------------------éºãƒ¦æ•¹fs_to_ds_bus----------------*/
+//wire [31:0] inst; ç€¹æ°«ç®Ÿé¦ã„¥å¢ é”Ÿï¿½????   
 wire [31:0] ds_pc;
 
 reg [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus_reg;
@@ -223,7 +223,7 @@ always @(posedge clk)
 assign {inst,ds_pc} = fs_to_ds_bus_reg;         //_reg;
 /*-------------------------------------------------------*/
 
-/*-----------------------æ¥æ”¶es,ms,ws_to_ds_bus----------------*/
+/*-----------------------éºãƒ¦æ•¹es,ms,ws_to_ds_bus----------------*/
 wire rf_we;
 wire [4:0] rf_waddr;
 wire [31:0] rf_wdata;
@@ -231,14 +231,17 @@ assign {rf_we,rf_waddr,rf_wdata} = ws_to_ds_bus;
 
 wire es_we;
 wire [4:0] es_dest;
+wire IF_LOAD;
+wire [31:0] es_wdata;
 wire ms_we;
 wire [4:0] ms_dest;
+wire [31:0] ms_wdata;
 
-assign {es_we,es_dest} = es_to_ds_bus;
-assign {ms_we,ms_dest} = ms_to_ds_bus;
+assign {es_we,es_dest,IF_LOAD,es_wdata} = es_to_ds_bus;
+assign {ms_we,ms_dest,ms_wdata} = ms_to_ds_bus;
 /*-------------------------------------------------------*/
 
-/*-----------------------å‘ï¿½?ï¿½br_bus----------------------*/
+/*-----------------------é™æˆ¯æ‹·?é”Ÿçµ™r_bus----------------------*/
 assign br_taken = ((inst_beq && rj_eq_rd) || (inst_bne && !rj_eq_rd)   
                    || inst_jirl || inst_bl || inst_b) && ds_valid;
 
@@ -250,15 +253,15 @@ assign br_target = (inst_beq || inst_bne || inst_bl || inst_b) ? (ds_pc + br_off
 assign br_bus = {br_taken_cancel,br_taken,br_target};           
 /*-------------------------------------------------------*/
 
-/*-----------------------å‘ï¿½?ï¿½ds_to_es_bus----------------*/
-assign rj_value  = rf_rdata1;   
-assign rkd_value = rf_rdata2;   
+/*-----------------------é™æˆ¯æ‹·?é”Ÿçµ›s_to_es_bus----------------*/
+assign rj_value  = forward_rdata1;   
+assign rkd_value = forward_rdata2;   
 assign imm = src2_is_4 ? 32'h4                      :   
              need_si20 ? {i20[19:0], 12'b0}         :   
              need_ui5  ? {27'b0,rk[4:0]}            :   
              need_si12 ? {{20{i12[11]}}, i12[11:0]} :   
              32'b0 ;
-assign dst_is_r1     = inst_bl;     //ä¸éœ€é€å‡ºï¼Œåªæ˜¯è¾…åŠ©dest
+assign dst_is_r1     = inst_bl;     //æ¶“å¶‰æ¸¶é–«ä½¸åš­é”›å±½å½§é„îˆç·Ÿé”ãƒ¾est
 assign dest = dst_is_r1 ? 5'd1 : rd;
 assign gr_we         = ~inst_st_w & ~inst_beq & ~inst_bne & ~inst_b;   
 assign mem_we        = inst_st_w;
@@ -291,84 +294,62 @@ assign src2_is_imm   = inst_slli_w |    //checked
 
 assign res_from_mem  = inst_ld_w;
 
-assign ds_to_es_bus[31:   0] = ds_pc;        //pcï¿½ï¿½ï¿½ï¿½fetchï¿½ï¿½???ï¿½ï¿½execute
-assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data1
-assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileï¿½ï¿½ï¿½ï¿½ï¿½ï¿½data2
-assign ds_to_es_bus[127: 96] = imm;       //Ñ¡ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿½?????
-assign ds_to_es_bus[132:128] = dest;      //Ğ´ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½???
-assign ds_to_es_bus[133:133] = gr_we;     //ï¿½Ç·ï¿½Ğ´ï¿½Ä´ï¿½ï¿½ï¿½
-assign ds_to_es_bus[134:134] = mem_we;    //ï¿½Ç·ï¿½Ğ´ï¿½ï¿½??
-assign ds_to_es_bus[146:135] = alu_op;    //aluï¿½ï¿½ï¿½ï¿½??
-assign ds_to_es_bus[147:147] = src1_is_pc;   //ï¿½ï¿½ï¿½ï¿½??1ï¿½Ç·ï¿½Îªpc
-assign ds_to_es_bus[148:148] = src2_is_imm;  //ï¿½ï¿½ï¿½ï¿½??2ï¿½Ç·ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
-assign ds_to_es_bus[149:149] = res_from_mem; //Ğ´ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú´ï¿½???
+assign ds_to_es_bus[31:   0] = ds_pc;        //pcé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·fetché”Ÿæ–¤æ‹·???é”Ÿæ–¤æ‹·execute
+assign ds_to_es_bus[63:  32] = rj_value;  //reg_fileé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·data1
+assign ds_to_es_bus[95:  64] = rkd_value; //reg_fileé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·data2
+assign ds_to_es_bus[127: 96] = imm;       //é€‰é”Ÿæ–¤æ‹·ç«é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿï¿½?????
+assign ds_to_es_bus[132:128] = dest;      //å†™é”Ÿæ–¤æ‹·æ‹‡é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿï¿½???
+assign ds_to_es_bus[133:133] = gr_we;     //é”Ÿè§’å‡¤æ‹·å†™é”Ÿä¾¥è¾¾æ‹·é”Ÿæ–¤æ‹·
+assign ds_to_es_bus[134:134] = mem_we;    //é”Ÿè§’å‡¤æ‹·å†™é”Ÿæ–¤æ‹·??
+assign ds_to_es_bus[146:135] = alu_op;    //alué”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??
+assign ds_to_es_bus[147:147] = src1_is_pc;   //é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??1é”Ÿè§’å‡¤æ‹·ä¸ºpc
+assign ds_to_es_bus[148:148] = src2_is_imm;  //é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·??2é”Ÿè§’å‡¤æ‹·ä¸ºé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·
+assign ds_to_es_bus[149:149] = res_from_mem; //å†™é”Ÿä¾¥è¾¾æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·æ¬ é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·è¯–é”Ÿï¿½???
 /*-------------------------------------------------------*/
 
 /*--------------------------------valid---------------------------*/
-reg ds_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿½?????
-//å¤„ç†å†™åè¯»å†²ï¿½??
-wire if_read_addr1;   //ï¿½Ç·ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½addr1
-wire if_read_addr2;   //ï¿½Ç·ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½addr2
+reg ds_valid;    //validæ·‡â€³å½¿ç›ã„§ãšæ©æ¬ç«´ç»¾Ñ„ç¥¦å§˜å¯¸ç´¦ç€›æ¨»æ§¸éšï¸½æ¹é”Ÿï¿½?????
+//æ¾¶å‹­æ‚Šéæ¬æ‚—ç’‡è¯²å•¿é”Ÿï¿½??
+wire if_read_addr1;   //é”Ÿè§’å‡¤æ‹·é”Ÿæ–¤æ‹·æ‹‡é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿçµ˜ddr1
+wire if_read_addr2;   //é”Ÿè§’å‡¤æ‹·é”Ÿæ–¤æ‹·æ‹‡é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿçµ˜ddr2
 
 assign if_read_addr1 = ~inst_b && ~inst_bl;
 assign if_read_addr2 = inst_beq || inst_bne || inst_xor || inst_or || inst_and || inst_nor ||
                        inst_sltu || inst_slt || inst_sub_w || inst_add_w || inst_st_w;
 
-wire if_crush_addr;    //addrï¿½Ç·ï¿½ï¿½ï¿½ï¿½Ğ´ï¿½ï¿½??
+wire Need_Block;    //ex_crush & IF_LOAD
 
-assign if_crush_addr = ex_crush || mem_crush || wb_crush;
+assign Need_Block = (ex_crush1 || ex_crush2) && IF_LOAD;
 
-/*
-reg skip_ex;
-reg skip_mem;
-reg skip_wb;
+wire ex_crush1;
+wire ex_crush2;
+assign ex_crush1 = (es_we && es_dest!=0) && (if_read_addr1 && rf_raddr1==es_dest);
+assign ex_crush2 = (es_we && es_dest!=0) && (if_read_addr2 && rf_raddr2==es_dest);
 
-always @(posedge clk)
-    begin
-        if(reset)
-            skip_ex <= 1'b0;
-        else if(ex_crush)
-            skip_ex <= 1'b1;
-        else if(ds_ready_go)
-            skip_ex <= 1'b0;
-    end
+wire mem_crush1;
+wire mem_crush2;
+assign mem_crush1 = (ms_we && ms_dest!=0) && (if_read_addr1 && rf_raddr1==ms_dest);
+assign mem_crush2 = (ms_we && ms_dest!=0) && (if_read_addr2 && rf_raddr2==ms_dest);
 
-always @(posedge clk)
-    begin
-        if(reset)
-            skip_mem <= 1'b0;
-        else if(mem_crush && !ex_crush)
-            skip_mem <= 1'b1;
-        else if(ds_ready_go)
-            skip_mem <= 1'b0;
-    end
-
-always @(posedge clk)
-    begin
-        if(reset)
-            skip_wb <= 1'b0;
-        else if(wb_crush && !mem_crush)
-            skip_wb <= 1'b1;
-        else if(ds_ready_go)
-            skip_wb <= 1'b0;
-    end
-*/
+wire wb_crush1;
+wire wb_crush2;
+assign wb_crush1 = (rf_we && rf_waddr!=0) && (if_read_addr1 && rf_raddr1==rf_waddr);
+assign wb_crush2 = (rf_we && rf_waddr!=0) && (if_read_addr2 && rf_raddr2==rf_waddr);
 
-wire ex_crush;
-assign ex_crush = ((es_we && es_dest!=0) && ( (if_read_addr1 && rf_raddr1==es_dest) || (if_read_addr2 && rf_raddr2==es_dest) )); // && !skip_ex;
-wire mem_crush;
-assign mem_crush = ((ms_we && ms_dest!=0) && ( (if_read_addr1 && rf_raddr1==ms_dest) || (if_read_addr2 && rf_raddr2==ms_dest) )); // && !skip_mem;
-wire wb_crush;
-assign wb_crush = ((rf_we && rf_waddr!=0) && ( (if_read_addr1 && rf_raddr1==rf_waddr) || (if_read_addr2 && rf_raddr2==rf_waddr) )); // && !skip_wb;
+//forward deliver
+wire [31:0] forward_rdata1;
+wire [31:0] forward_rdata2;
+assign forward_rdata1 = ex_crush1? es_wdata : mem_crush1? ms_wdata : wb_crush1? rf_wdata : rf_rdata1;
+assign forward_rdata2 = ex_crush2? es_wdata : mem_crush2? ms_wdata : wb_crush2? rf_wdata : rf_rdata2;
 
 wire ds_ready_go;
-assign ds_ready_go = ~if_crush_addr;         
+assign ds_ready_go = ~Need_Block;         
 assign ds_allow_in = !ds_valid || ds_ready_go && es_allow_in;
 assign ds_to_es_valid = ds_valid && ds_ready_go;
 
-//å½“æ•°æ®å†²çªï¼Œds_ready_goæ‹‰ä½ï¼Œds_allow_inå¯¹åº”æ‹‰ä½ï¼Œds_to_es_validå¯¹åº”æ‹‰ä½
+//è¤°æ’´æšŸé¹î†¼å•¿ç»ä¾Šç´ds_ready_goé·å¤‰ç¶†é”›å®’s_allow_inç€µç‘°ç°²é·å¤‰ç¶†é”›å®’s_to_es_validç€µç‘°ç°²é·å¤‰ç¶†
 
-assign br_taken_cancel =  if_crush_addr ? 1'b0 : br_taken;
+assign br_taken_cancel =  Need_Block ? 1'b0 : br_taken;
 
 always @(posedge clk)
     begin
@@ -381,7 +362,7 @@ always @(posedge clk)
     end
 /*----------------------------------------------------------------*/
 
-/*-------------------------ä¸regfileæ¥å£---------------------------*/
+/*-------------------------æ¶“å·–egfileéºãƒ¥å½›---------------------------*/
 assign rf_raddr1 = rj;  
 assign rf_raddr2 = src_reg_is_rd ? rd : rk; 
 regfile u_regfile(
@@ -396,7 +377,7 @@ regfile u_regfile(
     );
 /*
 assign {rf_we,rf_waddr,rf_wdata} = ws_to_ds_bus;
-æ„åœ¨å¼ºè°ƒæé†’æ­¤æ—¶çš„weï¼Œwaddrå’Œwdataæ¥è‡ªwbé˜¶æ®µå‘æ¥çš„ä¿¡ï¿½?????
+é°å¿“æ¹ªå¯®é¸¿çšŸé»æ„°å•‹å§ã‚†æ¤‚é¨å‰‹eé”›å¯ƒaddréœå¯ƒdataé‰ãƒ¨åšœwbé—ƒèˆµî†Œé™æˆæ½µé¨å‹ªä¿Šé”Ÿï¿½?????
 */
 /*----------------------------------------------------------------*/
 
diff --git a/cyt_code/for_patch/MEM.v b/cyt_code/for_patch/MEM.v
index e1656ff..2af2a5a 100644
--- a/cyt_code/for_patch/MEM.v
+++ b/cyt_code/for_patch/MEM.v
@@ -1,11 +1,11 @@
-`define WIDTH_BR_BUS       33
+`define WIDTH_BR_BUS       34
 `define WIDTH_FS_TO_DS_BUS 64
 `define WIDTH_DS_TO_ES_BUS 150
 `define WIDTH_ES_TO_MS_BUS 71
 `define WIDTH_MS_TO_WS_BUS 70
 `define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 6
-`define WIDTH_MS_TO_DS_BUS 6
+`define WIDTH_ES_TO_DS_BUS 39
+`define WIDTH_MS_TO_DS_BUS 38
 
 module stage4_MEM(
     input clk,
@@ -24,7 +24,7 @@ module stage4_MEM(
     input [31:0] data_sram_rdata
 );
 
-/*-----------------------æ¥æ”¶es_to_ms_bus----------------*/
+/*-----------------------éºãƒ¦æ•¹es_to_ms_bus----------------*/
 /*
 assign es_to_ms_bus[31:0] = es_pc;
 assign es_to_ms_bus[32:32] = es_gr_we;
@@ -55,7 +55,7 @@ assign {ms_alu_result, ms_dest, ms_res_from_mem,
 
 /*-------------------------------------------------------*/
 
-/*----------------------å‘ï¿½?ï¿½ms_to_ws_bus-----------------*/
+/*----------------------é™æˆ¯æ‹·?é”Ÿçµ¤s_to_ws_bus-----------------*/
 wire [31:0] mem_result;
 assign mem_result   = data_sram_rdata;
 wire [31:0] ms_final_result;
@@ -68,7 +68,7 @@ assign ms_to_ws_bus[69:38] = ms_final_result;
 /*-------------------------------------------------------*/
 
 /*--------------------------valid------------------------*/
-reg ms_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿½????
+reg ms_valid;    //validæ·‡â€³å½¿ç›ã„§ãšæ©æ¬ç«´ç»¾Ñ„ç¥¦å§˜å¯¸ç´¦ç€›æ¨»æ§¸éšï¸½æ¹é”Ÿï¿½????
 
 wire ms_ready_go;
 assign ms_ready_go = 1'b1;
@@ -85,8 +85,8 @@ always @(posedge clk)
 
 /*-------------------------------------------------------*/
 
-/*--------------------å‘ï¿½?ï¿½ms_to_ds_bus-------------------*/
-assign ms_to_ds_bus = {ms_gr_we,ms_dest};
+/*--------------------é™æˆ¯æ‹·?é”Ÿçµ¤s_to_ds_bus-------------------*/
+assign ms_to_ds_bus = {ms_gr_we,ms_dest,ms_final_result};
 /*-------------------------------------------------------*/
 
 endmodule
\ No newline at end of file
diff --git a/cyt_code/for_patch/WB.v b/cyt_code/for_patch/WB.v
index e25f344..fac7554 100644
--- a/cyt_code/for_patch/WB.v
+++ b/cyt_code/for_patch/WB.v
@@ -1,11 +1,11 @@
-`define WIDTH_BR_BUS       33
+`define WIDTH_BR_BUS       34
 `define WIDTH_FS_TO_DS_BUS 64
 `define WIDTH_DS_TO_ES_BUS 150
 `define WIDTH_ES_TO_MS_BUS 71
 `define WIDTH_MS_TO_WS_BUS 70
 `define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 6
-`define WIDTH_MS_TO_DS_BUS 6
+`define WIDTH_ES_TO_DS_BUS 39
+`define WIDTH_MS_TO_DS_BUS 38
 
 module stage5_WB(
     input clk,
@@ -26,7 +26,7 @@ module stage5_WB(
     output [31:0] debug_wb_rf_wdata
 );
 
-/*-----------------------æ¥æ”¶ms_to_ws_bus----------------*/
+/*-----------------------éºãƒ¦æ•¹ms_to_ws_bus----------------*/
 /*
 assign ms_to_ws_bus[31:0]  = ms_pc;
 assign ms_to_ws_bus[32:32] = ms_gr_we;
@@ -55,9 +55,9 @@ assign {ws_final_result, ws_dest,
 
 /*-------------------------------------------------------*/
 
-/*----------------------å‘ï¿½?ï¿½ws_to_ds_bus-----------------*/
+/*----------------------é™æˆ¯æ‹·?é”Ÿçµ¯s_to_ds_bus-----------------*/
 
-reg ws_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰ï¿½????
+reg ws_valid;    //validæ·‡â€³å½¿ç›ã„§ãšæ©æ¬ç«´ç»¾Ñ„ç¥¦å§˜å¯¸ç´¦ç€›æ¨»æ§¸éšï¸½æ¹é”Ÿï¿½????
 
 wire ws_we;
 assign ws_we = ws_gr_we && ws_valid;
@@ -73,7 +73,7 @@ assign ws_to_ds_bus[37:37] = ws_we;
 /*-------------------------------------------------------*/
 
 /*--------------------------valid------------------------*/
-//reg ws_valid;    //validä¿¡å·è¡¨ç¤ºè¿™ä¸€çº§æµæ°´ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œåœ¨ä¸Šé¢å®šä¹‰æ˜¯å› ä¸ºä¸Šé¢ç”¨äº†æ­¤ä¿¡ï¿½????
+//reg ws_valid;    //validæ·‡â€³å½¿ç›ã„§ãšæ©æ¬ç«´ç»¾Ñ„ç¥¦å§˜å¯¸ç´¦ç€›æ¨»æ§¸éšï¸½æ¹éå ¬ç´é¦ã„¤ç¬‚é—ˆãˆ ç•¾æ¶”å¤‹æ§¸é¥çŠ±è´Ÿæ¶“å©‡æ½°é¢ã„¤ç°¡å§ã‚„ä¿Šé”Ÿï¿½????
 wire ws_ready_go;
 assign ws_ready_go = 1'b1;
 assign ws_allow_in = !ws_valid || ws_ready_go;
diff --git a/cyt_code/for_patch/mycpu_top.v b/cyt_code/for_patch/mycpu_top.v
index 27103a1..5be1b64 100644
--- a/cyt_code/for_patch/mycpu_top.v
+++ b/cyt_code/for_patch/mycpu_top.v
@@ -4,8 +4,8 @@
 `define WIDTH_ES_TO_MS_BUS 71
 `define WIDTH_MS_TO_WS_BUS 70
 `define WIDTH_WS_TO_DS_BUS 38
-`define WIDTH_ES_TO_DS_BUS 6
-`define WIDTH_MS_TO_DS_BUS 6
+`define WIDTH_ES_TO_DS_BUS 39
+`define WIDTH_MS_TO_DS_BUS 38
 /*
 `include "stage1_IF.v"
 `include "stage2_ID.v"
@@ -57,6 +57,23 @@ wire [`WIDTH_ES_TO_DS_BUS-1:0] es_to_ds_bus;
 wire [`WIDTH_MS_TO_DS_BUS-1:0] ms_to_ds_bus;
 
 /*---------------------------FETCH--------------------------*/
+/*
+module stage1_IF(
+    input clk,
+    input reset,
+    input ds_allow_in,
+    input [`WIDTH_BR_BUS-1:0] br_bus,
+    output fs_to_ds_valid,
+    output [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
+
+    output inst_sram_en,
+    output [3:0] inst_sram_wen,
+    output [31:0] inst_sram_addr,
+    output [31:0] inst_sram_wdata,
+
+    input [31:0] inst_sram_rdata
+);
+*/
 
 stage1_IF fetch(
     .clk                (clk),
@@ -76,6 +93,28 @@ stage1_IF fetch(
 
 
 /*---------------------------DECODE--------------------------*/
+/*
+module stage2_ID(
+    input clk,
+    input reset,
+
+    input es_allow_in,
+    output ds_allow_in,
+
+    input fs_to_ds_valid,
+    output ds_to_es_valid, 
+
+    input [`WIDTH_FS_TO_DS_BUS-1:0] fs_to_ds_bus,
+    output [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
+
+    //ws_to_ds_bus æ‰¿è½½ å¯„å­˜å™¨çš„å†™ä¿¡å·ï¼Œå†™åœ°ï¿½???????ä¸å†™æ•°æ®
+    //ä»wbacké˜¶æ®µ é€æ¥ decodeé˜¶æ®µ 
+    input [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus;
+    //br_bus æ‰¿è½½ br_taken ï¿½??????? br_target 
+    //ä»decodeé˜¶æ®µ é€å¾€ fetché˜¶æ®µ
+    output [`WIDTH_BR_BUS-1:0] br_bus,
+);
+*/
 
 stage2_ID decode(
     .clk                (clk),
@@ -101,6 +140,26 @@ stage2_ID decode(
 
 
 /*---------------------------EXCUTE-------------------------*/
+/*
+module stage3_EX(
+    input clk,
+    input reset,
+
+    input ms_allow_in,
+    output es_allow_in,
+
+    input ds_to_es_valid,
+    output es_to_ms_valid,
+
+    input [`WIDTH_DS_TO_ES_BUS-1:0] ds_to_es_bus,
+    output [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
+
+    output data_sram_en,
+    output [3:0]data_sram_wen,
+    output [31:0] data_sram_addr,
+    output [31:0] data_sram_wdata
+);
+*/
 
 stage3_EX ex(
     .clk                (clk),
@@ -125,6 +184,23 @@ stage3_EX ex(
 /*----------------------------------------------------------*/
 
 /*---------------------------MEM----------------------------*/
+/*
+module stage4_MEM(
+    input clk,
+    input reset,
+
+    input ws_allow_in,
+    output ms_allow_in,
+
+    input es_to_ms_valid,
+    output ms_to_ws_valid,
+
+    input [`WIDTH_ES_TO_MS_BUS-1:0] es_to_ms_bus,
+    output [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
+    
+    input [31:0] data_sram_rdata
+);
+*/
 
 stage4_MEM mem(
     .clk                (clk),
@@ -146,6 +222,26 @@ stage4_MEM mem(
 /*----------------------------------------------------------*/
 
 /*---------------------------WBACK--------------------------*/
+/*
+module stage5_WB(
+    input clk,
+    input reset,
+
+    //no allow in
+    output ws_allow_in,
+
+    input ms_to_ws_valid,
+    //no to valid
+
+    input [`WIDTH_MS_TO_WS_BUS-1:0] ms_to_ws_bus,
+    output [`WIDTH_WS_TO_DS_BUS-1:0] ws_to_ds_bus,
+
+    output [31:0] debug_wb_pc     ,
+    output [ 3:0] debug_wb_rf_we ,
+    output [ 4:0] debug_wb_rf_wnum,
+    output [31:0] debug_wb_rf_wdata
+);
+*/
 
 stage5_WB wb(
     .clk                (clk),
@@ -166,5 +262,4 @@ stage5_WB wb(
 
 /*----------------------------------------------------------*/
 
-endmodule
-
+endmodule
\ No newline at end of file
-- 
2.36.1.windows.1

